(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,r=0;r<n.length;r++)if(n[r].identifier===e){t=r;break}return t}function r(e,r){for(var a={},i=[],s=0;s<e.length;s++){var d=e[s],l=r.base?d[0]+r.base:d[0],c=a[l]||0,u="".concat(l," ").concat(c);a[l]=c+1;var p=t(u),m={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)n[p].references++,n[p].updater(m);else{var g=o(m,r);r.byIndex=s,n.splice(s,0,{identifier:u,updater:g,references:1})}i.push(u)}return i}function o(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,o){var a=r(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var s=t(a[i]);n[s].references--}for(var d=r(e,o),l=0;l<a.length;l++){var c=t(a[l]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}a=d}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},173:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.creatModal=function(){const e=document.createElement("div");e.className="backdrop",e.onclick=()=>document.body.removeChild(e);const n=document.createElement("div");return n.className="modal",n.onclick=e=>e.stopPropagation(),e.appendChild(n),document.body.appendChild(e),{backdrop:e,modal:n}}},208:(e,n,t)=>{t.d(n,{A:()=>g});var r=t(601),o=t.n(r),a=t(314),i=t.n(a),s=t(691),d=t(828),l=t(330),c=t(998),u=t(247),p=t(943),m=i()(o());m.i(s.A),m.i(d.A),m.i(l.A),m.i(c.A),m.i(u.A),m.i(p.A),m.push([e.id,"\n",""]);const g=m},247:(e,n,t)=>{t.d(n,{A:()=>l});var r=t(601),o=t.n(r),a=t(314),i=t.n(a),s=t(565),d=i()(o());d.i(s.A),d.push([e.id,".backdrop {\n  position: fixed;\n  z-index: 1000;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.modal {\n  position: absolute;\n  color: var(--text-primary);\n  background-color: #ffffff;\n  width: 80vw;\n  max-width: 400px;\n  animation-name: animatetop;\n  animation-duration: 0.4s;\n}\n\n@keyframes animatetop {\n  from {\n    transform: translateY(-5vh);\n    opacity: 0;\n  }\n  to {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n\n.modal-content {\n  padding: 20px;\n}\n\n#roundBtn {\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 1.17em;\n  font-weight: bold;\n}\n",""]);const l=d},308:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.chatWindow=void 0,n.sendSystemMessage=function(e){m({id:l++,type:"system",senderId:"",senderName:"系统",text:e,timestamp:Date.now()})},n.connectCloversServer=g,t(897);const r=t(897);n.chatWindow=document.getElementById("chatWindow");const o=document.getElementById("messageInput"),a=document.getElementById("sendBtn"),i=document.getElementById("imageUpload"),s=document.getElementById("imagePreviewArea"),d=document.getElementById("cloversBtn");let l=0,c=[],u=null,p=null;function m(e){const t=document.createElement("div");if(t.className="message",t.dataset.id=e.id.toString(),"system"===e.type)t.classList.add("system"),t.innerHTML=`<p class="system-text">${e.text}</p>`;else if("user"===e.type){const n=e.senderName===r.currentUser.userName;t.classList.add(n?"self":"other");const o=document.createElement("p");o.className="username",o.textContent=e.senderName;const a=document.createElement("div");if(a.className="message-content",e.text){const n=document.createElement("p");n.className="message-text",n.textContent=e.text,a.appendChild(n)}e.images&&e.images.length>0&&e.images.forEach(e=>{const n=document.createElement("img");n.className="message-image-item",n.src=e,n.alt="聊天图片",n.loading="lazy",n.onclick=()=>{const n=document.createElement("div");n.className="backdrop",n.onclick=()=>document.body.removeChild(n),n.innerHTML=`<img src="${e}" style="max-width: 100%; max-height: 100%;">`,document.body.appendChild(n)},a.appendChild(n)}),t.appendChild(o),t.appendChild(a)}n.chatWindow.appendChild(t),localStorage.setItem("lastMessage",JSON.stringify(e)),n.chatWindow.scrollTop=n.chatWindow.scrollHeight}function g(e){if(p){if(p.url===e&&p.readyState===WebSocket.OPEN)return;p.close(1e3,"Changing server address"),p=null}var n;p=new WebSocket(e),(n=p).onopen=e=>{m({id:l++,type:"system",senderId:"",senderName:"系统",text:`连接成功！已连接到 ${n.url}`,timestamp:Date.now()}),null!=u&&(n.send(JSON.stringify(u)),u=null)},n.onmessage=e=>{console.log("Received message:",e.data),function(e){try{const n=JSON.parse(e);if(!n.senderName||!n.text)return void console.warn("Received malformed message:",n);n.id=l++,n.timestamp||(n.timestamp=Date.now()),m(n)}catch(n){m({id:l++,type:"system",senderId:"",senderName:"server",text:e.length>20?e.substring(0,18)+"...":e,timestamp:Date.now()}),console.error("Error parsing incoming message:",n,e)}}(e.data)},n.onclose=e=>{let n=e.reason||"服务器关闭";1e3!==e.code&&1005!==e.code&&(n=`连接异常关闭 (代码: ${e.code})`),m({id:l++,type:"system",senderId:"",senderName:"系统",text:`连接已断开: ${n}`,timestamp:Date.now()})},n.onerror=e=>{console.error("WebSocket Error:",e)}}function f(){const e=o.value.trim();if(!e&&0===c.length)return;const n=c.map(e=>new Promise(n=>{const t=new FileReader;t.onload=e=>{var t;return n(null===(t=e.target)||void 0===t?void 0:t.result)},t.readAsDataURL(e)}));Promise.all(n).then(n=>{const t={id:l++,type:"user",senderId:r.currentUser.userId,senderName:r.currentUser.userName,groupId:r.currentGroup.groupId,avatar:r.currentUser.avatar,groupAvatar:r.currentGroup.avatar,permission:r.currentUser.permission,text:e,images:n,timestamp:Date.now()};m(t),o.value="",c=[],i.value="",s.innerHTML="",s.classList.remove("active"),o.focus(),p?p.readyState===WebSocket.OPEN?p.send(JSON.stringify(t)):(u=t,g(p.url)):m({id:l++,type:"system",senderId:"",senderName:"系统",text:"未连接到 Clovers Client Console",timestamp:Date.now()})})}function v(e,n){const t=new FileReader;t.onload=e=>{var t;const r=document.createElement("div");r.className="preview-item";const o=document.createElement("button");o.className="delete-button",o.id="deleteImageBtn",o.innerHTML="×",o.title="移除图片",o.onclick=()=>function(e){c.splice(e,1),s.innerHTML="",c.length>0?c.forEach((e,n)=>v(e,n)):s.classList.remove("active")}(n),r.appendChild(o);const a=document.createElement("img");a.className="preview-image",a.src=null===(t=e.target)||void 0===t?void 0:t.result,r.appendChild(a),s.appendChild(r)},t.readAsDataURL(e)}a.addEventListener("click",f),i.addEventListener("change",e=>{const n=e.target.files;if(null!==n){for(let e=0;e<n.length;e++)n[e].type.startsWith("image/")&&c.push(n[e]);s.innerHTML="",c.forEach((e,n)=>v(e,n)),s.classList.add("active")}}),o.addEventListener("keydown",e=>{"Enter"===e.key&&(e.shiftKey||(e.preventDefault(),f()))}),d.addEventListener("click",()=>{let e=prompt("请输入 clovers 服务器地址:",(null==p?void 0:p.url)||"ws://");null!==e&&(e=e.trim(),e&&(e.startsWith("ws://")||e.startsWith("wss://")?(localStorage.setItem("CloversClientConsoleUrl",e),g(e)):alert("请使用 ws:// 或 wss:// 开头。")))})},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",r=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),r&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),r&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,r,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(i[d]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);r&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),n.push(c))}},n}},329:()=>{},330:(e,n,t)=>{t.d(n,{A:()=>c});var r=t(601),o=t.n(r),a=t(314),i=t.n(a),s=t(565),d=t(828),l=i()(o());l.i(s.A),l.i(d.A),l.push([e.id,".input-area {\n  flex-shrink: 0;\n  padding: 15px;\n  background: transparent;\n  background-color: var(--standard-bg);\n}\n\n/* 工具栏 */\n.toolbar {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.tool-btn {\n  display: flex;\n  background: none;\n  border: none;\n  cursor: pointer;\n  font-size: 1.3em;\n  color: var(--text-secondary);\n  border-radius: 50%;\n  width: 40px;\n  height: 40px;\n  padding: 0, 0;\n  margin: 0, 0;\n  align-items: center;\n  justify-content: center;\n}\n\n.tool-btn:hover {\n  background-color: rgba(67, 97, 238, 0.1);\n}\n\n.hidden {\n  display: none;\n}\n\n/* 图片预览区 */\n.image-preview-area {\n  overflow-x: auto;\n  overflow-y: hidden;\n  white-space: nowrap;\n  margin-bottom: 10px;\n  display: flex;\n  gap: 8px;\n  padding-top: 0;\n  transition: padding-top 0.1s ease-in-out;\n}\n\n.image-preview-area.active {\n  padding-top: 10px;\n}\n\n.preview-item {\n  position: relative;\n  padding: 0;\n  margin: 0;\n}\n\n.preview-image {\n  height: 16vh;\n  width: auto;\n  object-fit: cover;\n  border-radius: var(--radius-small);\n  box-shadow: var(--shadow-small);\n}\n\n#deleteImageBtn {\n  position: absolute;\n  top: -8px;\n  right: -8px;\n  padding: 0;\n  margin: 0;\n  align-items: center;\n  justify-content: center;\n  border: none;\n  border-radius: 50%;\n  width: 16px;\n  height: 16px;\n  font-size: 0.8em;\n  cursor: pointer;\n  box-shadow: var(--shadow-normal);\n}\n\n.input-send-row {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n\n#messageInput {\n  flex-grow: 1;\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-large);\n  padding: 12px 20px;\n  resize: none;\n  font-size: 1em;\n  line-height: 1.4;\n  box-sizing: border-box;\n  background: transparent;\n  background-color: #ffffffcc;\n  color: var(--text-primary);\n  transition: all 0.3s;\n}\n#messageInput::-webkit-scrollbar {\n  display: none;\n}\n\n#messageInput:focus {\n  outline: none;\n  border-color: var(--border-focus);\n  box-shadow: var(--shadow-normal);\n}\n\n#sendBtn {\n  border: none;\n  border-radius: 24px;\n  padding: 12px 20px;\n  cursor: pointer;\n  font-size: 1em;\n  align-self: center;\n  height: 100%;\n  min-height: 44px;\n  transition: all 0.2s;\n  font-weight: 600;\n}\n",""]);const c=l},511:(e,n,t)=>{t.r(n),t.d(n,{default:()=>h});var r=t(72),o=t.n(r),a=t(825),i=t.n(a),s=t(659),d=t.n(s),l=t(56),c=t.n(l),u=t(540),p=t.n(u),m=t(113),g=t.n(m),f=t(208),v={};v.styleTagTransform=g(),v.setAttributes=c(),v.insert=d().bind(null,"head"),v.domAPI=i(),v.insertStyleElement=p(),o()(f.A,v);const h=f.A&&f.A.locals?f.A.locals:void 0},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},565:(e,n,t)=>{t.d(n,{A:()=>s});var r=t(601),o=t.n(r),a=t(314),i=t.n(a)()(o());i.push([e.id,':root {\n  --main-bg: linear-gradient(45deg, #dde8ff 0%, #ddfeff 100%);\n  --standard-bg: rgba(255, 255, 255, 0.5);\n  --border-color: rgba(200, 200, 200, 0.6);\n  --border-focus: #4895ef;\n  --text-primary: #212529;\n  --text-secondary: #6c757d;\n  /* 阴影和圆角 */\n  --shadow-small: 0 2px 8px rgba(0, 0, 0, 0.1);\n  --shadow-normal: 0 4px 16px rgba(0, 0, 0, 0.2);\n  --shadow-large: 0 8px 24px rgba(0, 0, 0, 0.4);\n  --radius-small: 8px;\n  --radius-normal: 12px;\n  --radius-large: 16px;\n  --bezier-responsive: 0.4s cubic-bezier(0.25, 1, 0.5, 1);\n}\n\nhtml {\n  margin: 0;\n  padding: 0;\n  height: 100vh;\n  background: var(--main-bg);\n  color: var(--text-primary);\n}\nbody {\n  margin: 2vh;\n  height: 96vh;\n}\nbody,\nhtml {\n  font-family:\n    "Segoe UI",\n    system-ui,\n    -apple-system,\n    sans-serif;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.grow-flex {\n  display: flex;\n  flex-grow: 1;\n  flex-direction: row;\n  align-items: center;\n}\n',""]);const s=i},601:e=>{e.exports=function(e){return e[1]}},602:(e,n,t)=>{t.r(n),t.d(n,{deleteDB:()=>f,openDB:()=>g,unwrap:()=>m,wrap:()=>p});const r=(e,n)=>n.some(n=>e instanceof n);let o,a;const i=new WeakMap,s=new WeakMap,d=new WeakMap;let l={get(e,n,t){if(e instanceof IDBTransaction){if("done"===n)return i.get(e);if("store"===n)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return p(e[n])},set:(e,n,t)=>(e[n]=t,!0),has:(e,n)=>e instanceof IDBTransaction&&("done"===n||"store"===n)||n in e};function c(e){l=e(l)}function u(e){return"function"==typeof e?(n=e,(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(n)?function(...e){return n.apply(m(this),e),p(this.request)}:function(...e){return p(n.apply(m(this),e))}):(e instanceof IDBTransaction&&function(e){if(i.has(e))return;const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{n(),r()},a=()=>{t(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});i.set(e,n)}(e),r(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,l):e);var n}function p(e){if(e instanceof IDBRequest)return function(e){const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{n(p(e.result)),r()},a=()=>{t(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",a)});return d.set(n,e),n}(e);if(s.has(e))return s.get(e);const n=u(e);return n!==e&&(s.set(e,n),d.set(n,e)),n}const m=e=>d.get(e);function g(e,n,{blocked:t,upgrade:r,blocking:o,terminated:a}={}){const i=indexedDB.open(e,n),s=p(i);return r&&i.addEventListener("upgradeneeded",e=>{r(p(i.result),e.oldVersion,e.newVersion,p(i.transaction),e)}),t&&i.addEventListener("blocked",e=>t(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}function f(e,{blocked:n}={}){const t=indexedDB.deleteDatabase(e);return n&&t.addEventListener("blocked",e=>n(e.oldVersion,e)),p(t).then(()=>{})}const v=["get","getKey","getAll","getAllKeys","count"],h=["put","add","delete","clear"],b=new Map;function x(e,n){if(!(e instanceof IDBDatabase)||n in e||"string"!=typeof n)return;if(b.get(n))return b.get(n);const t=n.replace(/FromIndex$/,""),r=n!==t,o=h.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!v.includes(t))return;const a=async function(e,...n){const a=this.transaction(e,o?"readwrite":"readonly");let i=a.store;return r&&(i=i.index(n.shift())),(await Promise.all([i[t](...n),o&&a.done]))[0]};return b.set(n,a),a}c(e=>({...e,get:(n,t,r)=>x(n,t)||e.get(n,t,r),has:(n,t)=>!!x(n,t)||e.has(n,t)}));const y=["continue","continuePrimaryKey","advance"],w={},I=new WeakMap,L=new WeakMap,k={get(e,n){if(!y.includes(n))return e[n];let t=w[n];return t||(t=w[n]=function(...e){I.set(this,L.get(this)[n](...e))}),t}};async function*C(...e){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...e)),!n)return;const t=new Proxy(n,k);for(L.set(t,n),d.set(t,m(n));n;)yield t,n=await(I.get(t)||n.continue()),I.delete(t)}function E(e,n){return n===Symbol.asyncIterator&&r(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===n&&r(e,[IDBIndex,IDBObjectStore])}c(e=>({...e,get:(n,t,r)=>E(n,t)?C:e.get(n,t,r),has:(n,t)=>E(n,t)||e.has(n,t)}))},659:e=>{var n={};e.exports=function(e,t){var r=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}},691:(e,n,t)=>{t.d(n,{A:()=>c});var r=t(601),o=t.n(r),a=t(314),i=t.n(a),s=t(565),d=t(828),l=i()(o());l.i(s.A),l.i(d.A),l.push([e.id,'@keyframes float {\n  0% {\n    transform: translate(0, 0);\n  }\n  25% {\n    transform: translate(10vh, 5vh);\n  }\n  50% {\n    transform: translate(-5vh, 15vh);\n  }\n  75% {\n    transform: translate(15vh, -10vh);\n  }\n  100% {\n    transform: translate(0, 0);\n  }\n}\nbody::before,\nbody::after {\n  content: "";\n  position: fixed;\n  z-index: -1;\n  border-radius: 50%;\n  /* filter: blur(20vh); */\n  opacity: 0.5;\n}\n\nbody::before {\n  top: -10vh;\n  left: calc(50vw - 69vh);\n  width: 60vh;\n  height: 60vh;\n  background: var(--self-msg-color);\n  animation: float 61s infinite alternate;\n}\n\nbody::after {\n  bottom: -20vh;\n  left: calc(50vw + 12vh);\n  width: 80vh;\n  height: 80vh;\n  background: var(--user-msg-color);\n  animation: float 89s infinite alternate-reverse;\n}\n.side-toolbar {\n  display: flex;\n  width: 60px;\n  flex-direction: column;\n  overflow: hidden;\n  background-color: var(--standard-bg);\n}\n\n.ui {\n  position: relative;\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  max-width: 150vh;\n  margin: 0 auto;\n  box-shadow: var(--shadow-large);\n  border-radius: var(--radius-normal);\n  overflow: hidden;\n  -webkit-backdrop-filter: blur(20px) saturate(120%);\n  backdrop-filter: blur(20px) saturate(120%);\n}\n\n.sidebar-empty {\n  position: relative;\n  height: 100%;\n  max-width: 300px;\n  transition:\n    min-width var(--bezier-responsive),\n    width var(--bezier-responsive);\n  z-index: 0;\n}\n\n.sidebar {\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  max-width: 300px;\n  width: 30%;\n  min-width: 240px;\n  display: flex;\n  flex-direction: column;\n  background: transparent;\n  background-color: var(--standard-bg);\n  overflow: hidden;\n  white-space: nowrap;\n  transition:\n    width var(--bezier-responsive),\n    transform var(--bezier-responsive);\n  z-index: 100;\n}\n\n#sideBarTitle,\n#sideBarContent {\n  padding: 0, 0;\n  margin: 0, 0;\n}\n#sideBarContent {\n  overflow: auto;\n}\n\n#sideBarContent::-webkit-scrollbar {\n  display: none;\n}\n\n.chat-container {\n  display: flex;\n  flex: 1 0 0;\n  flex-direction: column;\n  max-height: 100%;\n  min-height: 0;\n  transition: width var(--bezier-responsive);\n}\n\n@media (orientation: portrait) {\n  .sidebar {\n    transform: translateX(-100%);\n  }\n  .sidebar-empty {\n    min-width: 0;\n    width: 0;\n  }\n  .sidebar.active {\n    width: 300px;\n    box-shadow: var(--shadow-large);\n    transform: translateX(0);\n  }\n  #groupListBtn {\n    display: block;\n  }\n}\n\n@media (orientation: landscape) {\n  .sidebar {\n    transform: translateX(0);\n  }\n  .sidebar-empty {\n    min-width: 240px;\n    width: 30%;\n  }\n  .sidebar.active {\n    width: 30%;\n  }\n  #groupListBtn {\n    display: none;\n  }\n}\n',""]);const c=l},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var r="";t.supports&&(r+="@supports (".concat(t.supports,") {")),t.media&&(r+="@media ".concat(t.media," {"));var o=void 0!==t.layer;o&&(r+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),r+=t.css,o&&(r+="}"),t.media&&(r+="}"),t.supports&&(r+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(r,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},828:(e,n,t)=>{t.d(n,{A:()=>l});var r=t(601),o=t.n(r),a=t(314),i=t.n(a),s=t(565),d=i()(o());d.i(s.A),d.push([e.id,":root {\n  --message-text-color: white;\n  --user-msg-color: linear-gradient(135deg, #4895ef 0%, #4361ee 100%);\n  --self-msg-color: linear-gradient(135deg, #84d368 0%, #68d39c 100%);\n}\n\n.chat-window {\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 0;\n  background: transparent;\n  overflow-y: auto;\n  padding: 20px;\n}\n/* 自定义滚动条样式 */\n.chat-window::-webkit-scrollbar {\n  width: 8px; /* 滚动条宽度 */\n}\n\n.chat-window::-webkit-scrollbar-track {\n  background: transparent; /* 滚动轨道背景透明 */\n}\n\n.chat-window::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2); /* 滚动条滑块颜色（半透明黑色） */\n}\n\n.chat-window::-webkit-scrollbar-thumb:hover {\n  background: rgba(0, 0, 0, 0.4); /* 悬停时加深颜色 */\n}\n\n.message {\n  margin-bottom: 15px;\n  display: flex;\n  flex-direction: column;\n  max-width: 85%;\n  animation: fadeIn 0.3s ease-out;\n  text-align: left;\n}\n\n.message.system {\n  align-self: center;\n  text-align: center;\n  width: 100%;\n}\n.system-text {\n  font-size: 0.85em;\n  color: var(--text-secondary);\n  background: var(--standard-bg);\n  display: inline-block;\n  margin: 0 auto;\n  padding: 8px var(--radius-large);\n  border-radius: var(--radius-large);\n}\n\n.message.self {\n  align-self: flex-end;\n}\n\n.message.other {\n  align-self: flex-start;\n}\n\n.message-content {\n  display: flex;\n  flex-direction: column;\n  padding: var(--radius-large);\n  border-radius: var(--radius-large);\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  max-width: 80%;\n  box-shadow: var(--shadow-normal);\n  color: var(--message-text-color);\n  gap: 8px;\n}\n\n.message.self .message-content {\n  align-self: flex-end;\n  background: var(--self-msg-color);\n}\n\n.message.other .message-content {\n  align-self: flex-start;\n  background: var(--user-msg-color);\n}\n\n/* 用户名 */\n.username {\n  font-size: 0.8em;\n  color: var(--text-primary);\n  margin-bottom: 6px;\n  font-weight: 300;\n  white-space: nowrap;\n}\n\n.message.self .username {\n  text-align: right;\n}\n\n.message.other .username {\n  text-align: left;\n}\n\n.message-text {\n  margin: 0;\n  font-size: 0.95em;\n  line-height: 1.5;\n}\n\n.message-image-item {\n  max-height: 32vh;\n  max-width: 16vw;\n  border-radius: var(--radius-normal);\n  transition: transform 0.2s;\n  box-shadow: var(--shadow-normal);\n  object-fit: cover;\n  cursor: pointer;\n}\n\n.message-image-item:hover {\n  transform: scale(1.05);\n}\n",""]);const l=d},849:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.renderUserList=function e({backdrop:n,modal:t}=(0,a.creatModal)()){function i(i){const s=document.createElement("div");s.className="itemlist-item";const d=i.avatar?`<img src="${i.avatar}" class="itemlist-item-avatar">`:'<div class="itemlist-item-avatar"></div>';s.innerHTML=`<div class="grow-flex">${d}<strong>${i.userName}:</strong><span>${i.userId}</span></div>`;const l=document.createElement("button");return l.className="tool-btn",l.innerHTML='<i class="fa-solid fa-gear"></i>',s.appendChild(l),s.addEventListener("click",()=>{document.body.removeChild(n),r.currentUser.userId!==i.userId&&((0,r.setCurrentUser)(i.userId),(0,o.sendSystemMessage)(`已切换用户为「${i.userName}」`))}),l.addEventListener("click",o=>{o.stopPropagation(),t.innerHTML="",function({backdrop:n,modal:t}=(0,a.creatModal)(),o){const i=document.createElement("div");i.className="modal-content",i.innerHTML=`\n<h3>请输入用户信息</h3>\n<div class="form-group">\n    <label for="nickname">用户名称:</label>\n    <input type="text" id="nickname" value="${o.userName}">\n</div>\n<div class="form-group">\n    <label for="userId">用户ID:</label>\n    <input type="text" id="userId" value="${o.userId}">\n</div>\n<div class="form-group">\n    <label for="avatarUrl">用户头像URL:</label>\n    <input type="text" id="avatarUrl" value="${o.avatar}">\n</div>\n<div class="form-group">\n    <label for="permission">用户权限:</label>\n    <select id="permission">\n        <option value="SuperUser" ${"SuperUser"===o.permission?"selected":""}>超级用户</option>\n        <option value="Owner" ${"Owner"===o.permission?"selected":""}>群主</option>\n        <option value="Admin" ${"Admin"===o.permission?"selected":""}>管理员</option>\n        <option value="Member" ${"Member"===o.permission?"selected":""}>成员</option>\n    </select>\n</div>`;const s=document.createElement("button");s.className="confirm-button",s.textContent="确认";const d=document.createElement("button");d.className="cancle-button",d.textContent="取消";const l=document.createElement("button");l.className="delete-button",l.textContent="删除";const c=document.createElement("div");c.className="form-actions",c.appendChild(s),c.appendChild(d),c.appendChild(l),i.appendChild(c),t.appendChild(i),s.onclick=()=>{const t=i.querySelector("#userId").value.trim(),a=i.querySelector("#nickname").value.trim(),s=i.querySelector("#avatarUrl").value.trim(),d=i.querySelector("#permission").value;o.userId=t,o.userName=a,o.avatar=s,o.permission=d,document.body.removeChild(n),e(),localStorage.setItem("userList",JSON.stringify(r.userList))},d.onclick=()=>{t.innerHTML="",e({backdrop:n,modal:t})},l.onclick=()=>{const t=r.userList.indexOf(o);-1!==t&&r.userList.splice(t,1),r.currentUser.userId===o.userId&&(0,r.setCurrentUser)("1"),document.body.removeChild(n),e(),localStorage.setItem("userList",JSON.stringify(r.userList))}}({backdrop:n,modal:t},i)}),s}const s=document.createElement("div");s.className="modal-content";const d=document.createElement("div");d.className="itemlist-title",d.innerHTML='<div class="grow-flex"><h3>用户列表</h3></div>';const l=document.createElement("button");l.id="roundBtn",l.className="confirm-button",l.innerHTML='<i class="fa-solid fa-plus"></i>',l.onclick=()=>{let e=Object.assign(Object.assign({},r.defaultUserInfo),{userId:Date.now().toString()});r.userList.push(e),s.appendChild(i(e)),localStorage.setItem("userList",JSON.stringify(r.userList))},d.appendChild(l),s.appendChild(d),0===r.userList.length&&(0,r.setCurrentUser)("1"),r.userList.forEach(e=>s.appendChild(i(e)));const c=document.createElement("button");c.className="delete-all-button",c.innerHTML='<i class="fa-solid fa-trash"></i>',c.onclick=()=>{r.userList.length=0,(0,r.setCurrentUser)("1"),localStorage.setItem("userList",JSON.stringify(r.userList)),t.innerHTML="",e({backdrop:n,modal:t})},t.appendChild(s),t.appendChild(c)},t(329);const r=t(897),o=t(308),a=t(173)},891:function(e,n,t){var r=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{d(r.next(e))}catch(e){a(e)}}function s(e){try{d(r.throw(e))}catch(e){a(e)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(i,s)}d((r=r.apply(e,n||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.renderGroupList=function(){0===o.groupList.length&&(0,o.setCurrentGroup)("1"),l.innerHTML="",o.groupList.forEach(e=>l.appendChild(u(e))),c.innerHTML='<div class="grow-flex"><strong>会话列表</strong></div>';const e=document.createElement("button");e.className="tool-btn",e.innerHTML='<i class="fa-solid fa-plus"></i>',c.appendChild(e),e.onclick=()=>{let e=Object.assign(Object.assign({},o.defaultGroupInfo),{groupId:Date.now().toString()});o.groupList.push(e),l.appendChild(u(e)),localStorage.setItem("groupList",JSON.stringify(o.groupList))}},t(329);const o=t(897),a=t(308),i=t(173),s=(0,t(602).openDB)("ChatAppDB",1,{upgrade(e){e.objectStoreNames.contains("histories")||e.createObjectStore("histories")}}),d={set(e,n){return r(this,void 0,void 0,function*(){const t=yield s;yield t.put("histories",n,e)})},get(e){return r(this,void 0,void 0,function*(){const n=yield s;return(yield n.get("histories",e))||""})},delete(e){return r(this,void 0,void 0,function*(){const n=yield s;yield n.delete("histories",e)})},clearAll(){return r(this,void 0,void 0,function*(){const e=yield s;yield e.clear("histories")})}},l=(document.getElementById("sideBarArea"),document.getElementById("sideBarContent")),c=document.getElementById("sideBarTitle");function u(e){const n=document.createElement("div");n.className="itemlist-item";const t=e.avatar?`<img src="${e.avatar}" class="itemlist-item-avatar">`:'<div class="itemlist-item-avatar"></div>';n.innerHTML=`<div class="grow-flex">${t}<strong>${e.groupName}</strong></div>`;const s=document.createElement("button");return s.className="tool-btn",s.innerHTML='<i class="fa-solid fa-gear"></i>',n.appendChild(s),n.addEventListener("click",()=>r(this,void 0,void 0,function*(){if(o.currentGroup.groupId===e.groupId)return;const n=a.chatWindow.cloneNode(!0);n.querySelectorAll("div.message.system").forEach(e=>e.remove()),yield d.set(o.currentGroup.groupId,n.innerHTML),a.chatWindow.innerHTML=yield d.get(e.groupId),(0,o.setCurrentGroup)(e.groupId)})),s.addEventListener("click",n=>{n.stopPropagation(),function({backdrop:e,modal:n}=(0,i.creatModal)(),t){const s=document.createElement("div");s.className="modal-content",s.innerHTML=`\n<h3>请输入会话信息</h3>\n<div class="form-group">\n    <label for="nickname">会话名称:</label>\n    <input type="text" id="groupName" value="${t.groupName}">\n</div>\n<div class="form-group">\n    <label for="groupId">会话ID:</label>\n    <input type="text" id="groupId" value="${t.groupId}">\n</div>\n<div class="form-group">\n    <label for="avatarUrl">会话头像URL:</label>\n    <input type="text" id="groupAvatarUrl" value="${t.avatar}">\n</div>`;const c=document.createElement("button");c.className="confirm-button",c.textContent="确认";const p=document.createElement("button");p.className="cancle-button",p.textContent="取消";const m=document.createElement("button");m.className="delete-button",m.textContent="删除";const g=document.createElement("div");g.className="form-actions",g.appendChild(c),g.appendChild(p),g.appendChild(m),s.appendChild(g),n.appendChild(s),c.onclick=()=>{t.groupName=s.querySelector("#groupName").value.trim(),t.groupId=s.querySelector("#groupId").value.trim(),t.avatar=s.querySelector("#groupAvatarUrl").value.trim(),l.innerHTML="",o.groupList.forEach(e=>l.appendChild(u(e))),document.body.removeChild(e),localStorage.setItem("groupList",JSON.stringify(o.groupList))},p.onclick=()=>document.body.removeChild(e),m.onclick=()=>r(this,void 0,void 0,function*(){const n=o.groupList.indexOf(t);-1!==n&&o.groupList.splice(n,1),d.delete(t.groupId),o.currentGroup.groupId===t.groupId&&((0,o.setCurrentGroup)("1"),a.chatWindow.innerHTML=yield d.get(o.currentGroup.groupId)),l.innerHTML="",o.groupList.forEach(e=>l.appendChild(u(e))),document.body.removeChild(e),localStorage.setItem("groupList",JSON.stringify(o.groupList))})}((0,i.creatModal)(),e)}),n}},897:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.currentGroup=n.currentUser=n.defaultGroupInfo=n.defaultUserInfo=void 0,n.setCurrentUser=function(e){n.userList.length<1?(n.userList.push(Object.assign({},n.defaultUserInfo)),n.currentUser=n.userList[0]):n.currentUser=n.userList.find(n=>n.userId===e)||n.userList[0],localStorage.setItem("userId",n.currentUser.userId)},n.setCurrentGroup=function(e){n.groupList.length<1?(n.groupList.push(Object.assign({},n.defaultGroupInfo)),n.currentGroup=n.groupList[0]):n.currentGroup=n.groupList.find(n=>n.groupId===e)||n.groupList[0],localStorage.setItem("groupId",n.currentGroup.groupId)},t(329),n.defaultUserInfo={userId:"1",userName:"用户",avatar:"",permission:"SuperUser"},n.defaultGroupInfo={groupId:"1",groupName:"群组",avatar:""},n.userList=[],n.groupList=[]},943:(e,n,t)=>{t.d(n,{A:()=>l});var r=t(601),o=t.n(r),a=t(314),i=t.n(a),s=t(565),d=i()(o());d.i(s.A),d.push([e.id,":root {\n  --item-padding: 12px 12px;\n  --item-select-color: rgba(0, 0, 0, 0.2);\n}\n\n.itemlist-title,\n.itemlist-item {\n  display: flex;\n  height: 48px;\n  flex-direction: row;\n  align-items: center;\n  padding: var(--item-padding);\n  padding-right: 12px;\n  color: var(--text-primary);\n}\n.itemlist-title {\n  min-height: 48px;\n}\n.itemlist-item {\n  min-height: 0;\n}\n\n.itemlist-item {\n  animation: fadeIn 0.3s ease-out;\n}\n\n.itemlist-item-avatar {\n  border-radius: 50%;\n  width: 40px;\n  height: 40px;\n  margin-right: 12px;\n  background-color: #ccc;\n}\n\n.itemlist-item:hover {\n  background: var(--item-select-color);\n}\n\n.form-group {\n  margin-bottom: 20px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 600;\n  font-size: 0.95em;\n  color: var(--text-primary);\n}\n\n.form-group input,\n.form-group select {\n  width: 100%;\n  padding: 12px 15px;\n  box-sizing: border-box;\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-small);\n  font-size: 1em;\n  background-color: #f8f9fa;\n  color: var(--text-primary);\n  transition: all 0.3s;\n}\n\n.form-group input:focus,\n.form-group select:focus {\n  outline: none;\n  border-color: var(--border-focus);\n  box-shadow: var(--shadow-small);\n}\n\n.form-actions {\n  margin-top: 25px;\n  text-align: right;\n}\n\n.form-actions button {\n  padding: 12px 20px;\n  margin-left: 12px;\n  border: none;\n  border-radius: var(--radius-normal);\n  cursor: pointer;\n  font-weight: 600;\n}\n\n.delete-all-button {\n  width: 100%;\n  height: 60px;\n  min-height: 60px;\n  margin: 0, 0;\n  border: none;\n  font-size: 1.8em;\n  color: var(--text-secondary);\n  background: var(--standard-bg);\n  color: #ccc;\n}\n.delete-all-button:hover {\n  color: #dc3545;\n  background: var(--item-select-color);\n}\n",""]);const l=d},998:(e,n,t)=>{t.d(n,{A:()=>s});var r=t(601),o=t.n(r),a=t(314),i=t.n(a)()(o());i.push([e.id,".confirm-button {\n  background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);\n  color: white;\n}\n\n.confirm-button:hover {\n  background: linear-gradient(135deg, #3a56d4 0%, #2f4ac9 100%);\n}\n\n.cancle-button {\n  background: #e9ecef;\n  color: black;\n}\n\n.cancle-button:hover {\n  background: #dee2e6;\n}\n\n.delete-button {\n  background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);\n  color: white;\n}\n\n.delete-button:hover {\n  background: linear-gradient(135deg, #bd2130 0%, #a71e2a 100%);\n}\n\n.confirm-button,\n.cancle-button,\n.delete-button {\n  cursor: pointer;\n  transition: transform var(--bezier-responsive);\n}\n\n.confirm-button:hover,\n.cancle-button:hover,\n.delete-button:hover {\n  transform: translateY(-2px);\n}\n\n.confirm-button:active,\n.cancle-button:active,\n.delete-button:active {\n  transform: translateY(0);\n}\n",""]);const s=i}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var a=n[r]={id:r,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nc=void 0,(()=>{t(511);const e=t(897),n=t(308),r=t(849),o=t(891),a=document.getElementById("sideBarArea");let i=!1;document.getElementById("userListBtn").onclick=()=>{(0,r.renderUserList)()},document.getElementById("groupListBtn").onclick=function(e){a.classList.add("active"),i=!0,e.stopPropagation()},document.addEventListener("click",e=>{!function(e){i&&!a.contains(e.target)&&(a.classList.remove("active"),i=!1)}(e)}),document.addEventListener("DOMContentLoaded",()=>{e.userList.length=0;try{const n=localStorage.getItem("userList");if(!n)throw new Error("Default");e.userList.push(...JSON.parse(n))}catch(e){console.error("Error parsing userList:",e)}(0,e.setCurrentUser)(localStorage.getItem("userId")||"1"),e.groupList.length=0;try{const n=localStorage.getItem("groupList");if(!n)throw new Error("Default");e.groupList.push(...JSON.parse(n))}catch(e){console.error("Error parsing groupList:",e)}(0,e.setCurrentGroup)(localStorage.getItem("groupId")||"1"),(0,o.renderGroupList)();let t=localStorage.getItem("CloversClientConsoleUrl")||"ws://localhost:11000";(0,n.connectCloversServer)(t)})})()})();