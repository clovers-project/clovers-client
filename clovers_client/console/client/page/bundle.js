(()=>{"use strict";var n={56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},72:n=>{var e=[];function t(n){for(var t=-1,r=0;r<e.length;r++)if(e[r].identifier===n){t=r;break}return t}function r(n,r){for(var a={},i=[],s=0;s<n.length;s++){var d=n[s],l=r.base?d[0]+r.base:d[0],c=a[l]||0,m="".concat(l," ").concat(c);a[l]=c+1;var p=t(m),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var g=o(u,r);r.byIndex=s,e.splice(s,0,{identifier:m,updater:g,references:1})}i.push(m)}return i}function o(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,o){var a=r(n=n||[],o=o||{});return function(n){n=n||[];for(var i=0;i<a.length;i++){var s=t(a[i]);e[s].references--}for(var d=r(n,o),l=0;l<a.length;l++){var c=t(a[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}a=d}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},208:(n,e,t)=>{t.d(e,{A:()=>s});var r=t(601),o=t.n(r),a=t(314),i=t.n(a)()(o());i.push([n.id,':root {\n  /* 新的清新风格配色 */\n  --main-bg: linear-gradient(45deg, #dde8ff 0%, #ddfeff 100%);\n  --chat-bg: rgba(255, 255, 255, 0.5);\n  --input-bg: rgba(255, 255, 255, 0.4);\n  --system-msg-color: #6c757d;\n  --user-msg-bg: #84d368;\n  --user-msg-bg2: #68d39c;\n  --self-msg-bg: #4895ef;\n  --self-msg-bg2: #4361ee;\n  /* --border-color: #e9ecef; */\n  --border-color: rgba(255, 255, 255, 0.3);\n  --text-primary: #212529;\n  --text-secondary: #6c757d;\n  /* 阴影和圆角 */\n  --shadow-small: 0 2px 8px rgba(0, 0, 0, 0.05);\n  --shadow-normal: 0 4px 16px rgba(0, 0, 0, 0.08);\n  --shadow-large: 0 8px 24px rgba(0, 0, 0, 0.1);\n  --radius-small: 8px;\n  --radius-normal: 12px;\n  --radius-large: 16px;\n  /* 按钮 */\n  --send-btn-color: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);\n  --send-btn-color-hover: linear-gradient(135deg, #3a56d4 0%, #2f4ac9 100%);\n  --cancel-btn-color: #e9ecef;\n  --cancel-btn-color-hover: #dee2e6;\n  --delete-btn-color: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);\n  --delete-btn-color-hover: linear-gradient(135deg, #bd2130 0%, #a71e2a 100%);\n  /* 文字颜色 */\n  --message-text-color: white;\n}\n\nhtml {\n  margin: 0;\n  padding: 0;\n  height: 100vh;\n  background: var(--main-bg);\n  color: var(--text-primary);\n}\nbody {\n  margin: 2vh;\n  height: 96vh;\n}\nbody,\nhtml {\n  font-family:\n    "Segoe UI",\n    system-ui,\n    -apple-system,\n    sans-serif;\n}\n\n@keyframes float {\n  0% {\n    transform: translate(0, 0);\n  }\n  25% {\n    transform: translate(10vh, 5vh);\n  }\n  50% {\n    transform: translate(-5vh, 15vh);\n  }\n  75% {\n    transform: translate(15vh, -10vh);\n  }\n  100% {\n    transform: translate(0, 0);\n  }\n}\nbody::before,\nbody::after {\n  content: "";\n  position: fixed;\n  z-index: -1;\n  border-radius: 50%;\n  /* filter: blur(20vh); */\n  opacity: 0.5;\n}\n\nbody::before {\n  top: -10vh;\n  left: calc(50vw - 69vh);\n  width: 60vh;\n  height: 60vh;\n  background: var(--self-msg-bg); /* 左气泡使用右气泡左渐变 */\n  animation: float 61s infinite alternate;\n}\n\nbody::after {\n  bottom: -20vh;\n  left: calc(50vw + 12vh);\n  width: 80vh;\n  height: 80vh;\n  background: var(--user-msg-bg2); /* 右气泡使用左气泡右渐变 */\n  animation: float 89s infinite alternate-reverse;\n}\n\n.chat-container {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  max-width: 800px;\n  margin: 0 auto;\n  box-shadow: var(--shadow-large);\n  border-top: 1px solid var(--border-color);\n  border-left: 1px solid var(--border-color);\n  border-radius: var(--radius-normal);\n  overflow: hidden;\n  background-color: var(--chat-bg);\n  -webkit-backdrop-filter: blur(20px) saturate(180%);\n  backdrop-filter: blur(20px) saturate(180%);\n}\n\n/* 聊天窗口 (上半部分) */\n.chat-window {\n  background: transparent;\n  flex-grow: 1;\n  overflow-y: auto;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  overflow-y: auto;\n}\n/* 自定义滚动条样式 */\n.chat-window::-webkit-scrollbar {\n  width: 8px; /* 滚动条宽度 */\n}\n\n.chat-window::-webkit-scrollbar-track {\n  background: transparent; /* 滚动轨道背景透明 */\n}\n\n.chat-window::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2); /* 滚动条滑块颜色（半透明黑色） */\n}\n\n.chat-window::-webkit-scrollbar-thumb:hover {\n  background: rgba(0, 0, 0, 0.4); /* 悬停时加深颜色 */\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.message {\n  margin-bottom: 15px;\n  display: flex;\n  flex-direction: column;\n  max-width: 85%;\n  animation: fadeIn 0.3s ease-out;\n  text-align: left;\n}\n\n.message.self {\n  align-self: flex-end;\n}\n\n.message.other {\n  align-self: flex-start;\n}\n\n.message.system {\n  align-self: center;\n  text-align: center;\n  width: 100%;\n}\n.system-text {\n  font-size: 0.85em;\n  color: var(--system-msg-color);\n  background: var(--chat-bg);\n  display: inline-block;\n  margin: 0 auto;\n  padding: 8px 15px;\n  border-radius: 20px;\n}\n/* 消息内容容器 */\n.message-content {\n  padding: 12px 16px;\n  border-radius: var(--radius-large);\n  position: relative;\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  max-width: 80%;\n  width: fit-content;\n  box-shadow: var(--shadow-small);\n  transition:\n    transform 0.2s ease,\n    box-shadow 0.2s ease;\n  color: var(--message-text-color);\n}\n\n/* 自己的消息气泡 */\n.message.self .message-content {\n  align-self: flex-end;\n  background: linear-gradient(135deg, var(--self-msg-bg) 0%, var(--self-msg-bg2) 100%);\n}\n\n/* 其他用户的消息气泡 */\n.message.other .message-content {\n  align-self: flex-start;\n  background: linear-gradient(135deg, var(--user-msg-bg) 0%, var(--user-msg-bg2) 100%);\n}\n\n/* 用户名 */\n.username {\n  font-size: 0.8em;\n  color: var(--text-secondary);\n  margin-bottom: 5px;\n  font-weight: 600;\n  white-space: nowrap;\n}\n\n.message.self .username {\n  text-align: right;\n  color: var(--text-primary);\n}\n\n.message.other .username {\n  color: var(--text-primary);\n}\n\n.message-text {\n  margin: 0;\n  font-size: 0.95em;\n  line-height: 1.5;\n}\n\n/* 消息中的图片 */\n.message-image {\n  max-width: 100%;\n  border-radius: var(--radius-small);\n  margin-top: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.image-group {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  margin-top: 8px;\n}\n\n.message-image-item {\n  height: 16vh;\n  border-radius: var(--radius-small);\n  cursor: pointer;\n  transition: transform 0.2s;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  object-fit: contain;\n}\n\n.message-image-item:hover {\n  transform: scale(1.05);\n}\n\n/* 输入区域 (下半部分) */\n.input-area {\n  padding: 15px;\n  background: transparent;\n  background-color: var(--input-bg);\n  border-top: 1px solid var(--border-color);\n  border-left: 1px solid var(--border-color);\n}\n\n/* 工具栏 */\n.toolbar {\n  height: 40px;\n  display: flex;\n  align-items: center;\n  gap: 15px;\n  margin-bottom: 10px;\n}\n\n.tool-btn {\n  background: none;\n  border: none;\n  cursor: pointer;\n  font-size: 1.3em;\n  color: var(--text-secondary);\n  padding: 6px;\n  transition: all 0.2s;\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.tool-btn:hover {\n  color: var(--send-btn-color);\n  background-color: rgba(67, 97, 238, 0.1);\n}\n\n/* 图片预览区 */\n.image-preview-area {\n  overflow-x: auto;\n  overflow-y: hidden;\n  white-space: nowrap;\n  margin-bottom: 10px;\n  display: flex;\n  gap: 10px;\n  border-top: 1px dashed transparent;\n  padding-top: 0;\n  transition: all 0.2s ease-in-out;\n}\n\n.image-preview-area.active {\n  padding-top: 10px;\n}\n\n.preview-item {\n  position: relative;\n  display: inline-block;\n  height: 16vh;\n}\n\n.preview-image {\n  height: 100%;\n  width: auto;\n  border-radius: var(--radius-small);\n  object-fit: cover;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n}\n\n.remove-image-btn {\n  position: absolute;\n  top: -8px;\n  right: -8px;\n  background: var(--delete-btn-color);\n  color: white;\n  border: none;\n  border-radius: 50%;\n  font-size: 0.7em;\n  width: 20px;\n  height: 20px;\n  line-height: 20px;\n  text-align: center;\n  cursor: pointer;\n  padding: 0;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n}\n\n.remove-image-btn:hover {\n  background: var(--delete-btn-color-hover);\n}\n\n/* 输入框和发送按钮行 */\n.input-send-row {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n#messageInput {\n  flex-grow: 1;\n  border: 1px solid var(--border-color);\n  border-radius: 24px;\n  padding: 12px 20px;\n  resize: none;\n  font-size: 1em;\n  line-height: 1.4;\n  box-sizing: border-box;\n  background: transparent;\n  background-color: #ffffffcc;\n  color: var(--text-primary);\n  transition: all 0.3s;\n}\n#messageInput::-webkit-scrollbar {\n  display: none;\n}\n\n#messageInput:focus {\n  outline: none;\n  border-color: var(--self-msg-bg2);\n  box-shadow: var(--shadow-large);\n}\n\n#sendBtn {\n  background: var(--send-btn-color);\n  color: white;\n  border: none;\n  border-radius: 24px;\n  padding: 12px 20px;\n  cursor: pointer;\n  font-size: 1em;\n  align-self: center;\n  height: 100%;\n  min-height: 44px;\n  transition: all 0.2s;\n  font-weight: 600;\n}\n\n#sendBtn:hover {\n  background: var(--send-btn-color-hover);\n  transform: translateY(-2px);\n}\n\n.modal {\n  position: fixed;\n  z-index: 1000;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.modal-content {\n  background: #ffffff;\n  padding: 25px;\n  border: 1px solid var(--border-color);\n  width: 80%;\n  max-width: 400px;\n  animation-name: animatetop;\n  animation-duration: 0.4s;\n  color: var(--text-primary);\n}\n\n.user-list-title {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 0px;\n  padding-right: 12px;\n  font-size: 1.17em;\n  font-weight: bold;\n}\n\n#addUserBtn {\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  background: var(--send-btn-color);\n  color: white;\n  border: none;\n  cursor: pointer;\n  transition: all 0.2s;\n  font-size: 1.17em;\n  font-weight: bold;\n}\n\n#addUserBtn:hover {\n  background: var(--send-btn-color-hover);\n}\n\n.user-item {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 0px;\n  padding-right: 12px;\n  animation: fadeIn 0.3s ease-out;\n}\n\n.user-item:hover {\n  background: var(--cancel-btn-color-hover);\n}\n\n@keyframes animatetop {\n  from {\n    top: -300px;\n    opacity: 0;\n  }\n  to {\n    top: 0;\n    opacity: 1;\n  }\n}\n\n.modal-content h3 {\n  border-bottom: 1px solid var(--border-color);\n  padding-bottom: 15px;\n  margin-top: 0;\n  color: var(--text-primary);\n}\n\n.form-group {\n  margin-bottom: 20px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 600;\n  font-size: 0.95em;\n  color: var(--text-secondary);\n}\n\n.form-group input,\n.form-group select {\n  width: 100%;\n  padding: 12px 15px;\n  box-sizing: border-box;\n  border: 1px solid var(--border-color);\n  border-radius: var(--radius-small);\n  font-size: 1em;\n  background-color: #f8f9fa;\n  color: var(--text-primary);\n  transition: all 0.3s;\n}\n\n.form-group input:focus,\n.form-group select:focus {\n  outline: none;\n  border-color: var(--self-msg-bg2);\n  box-shadow: var(--shadow-large);\n}\n\n.form-actions {\n  margin-top: 25px;\n  text-align: right;\n}\n\n.form-actions button {\n  padding: 12px 20px;\n  margin-left: 12px;\n  border: none;\n  border-radius: var(--radius-small);\n  cursor: pointer;\n  font-weight: 600;\n  transition: all 0.2s;\n}\n\n#confirmBtn {\n  background: var(--send-btn-color);\n  color: white;\n  cursor: pointer;\n}\n\n#confirmBtn:hover {\n  background: var(--send-btn-color-hover);\n  transform: translateY(-2px);\n}\n\n#cancelBtn {\n  background: var(--cancel-btn-color);\n  color: var(--text-primary);\n  cursor: pointer;\n}\n\n#cancelBtn:hover {\n  background: var(--cancel-btn-color-hover);\n  transform: translateY(-2px);\n}\n\n#deleteBtn {\n  background: var(--delete-btn-color);\n  color: white;\n  cursor: pointer;\n}\n\n#deleteBtn:hover {\n  background: var(--delete-btn-color-hover);\n  transform: translateY(-2px);\n}\n\n#sendBtn:active,\n#confirmBtn:active,\n#cancelBtn:active,\n#deleteBtn :active {\n  transform: translateY(0);\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .chat-container {\n    border-radius: 0;\n    box-shadow: none;\n    height: 100vh;\n    max-width: 100%;\n  }\n\n  .message {\n    max-width: 90%;\n  }\n\n  .modal-content {\n    width: 95%;\n    padding: 20px;\n  }\n}\n',""]);const s=i},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var t="",r=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),r&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),r&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t}).join("")},e.i=function(n,t,r,o,a){"string"==typeof n&&(n=[[null,n,void 0]]);var i={};if(r)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(i[d]=!0)}for(var l=0;l<n.length;l++){var c=[].concat(n[l]);r&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},511:(n,e,t)=>{t.r(e),t.d(e,{default:()=>b});var r=t(72),o=t.n(r),a=t(825),i=t.n(a),s=t(659),d=t.n(s),l=t(56),c=t.n(l),m=t(540),p=t.n(m),u=t(113),g=t.n(u),f=t(208),v={};v.styleTagTransform=g(),v.setAttributes=c(),v.insert=d().bind(null,"head"),v.domAPI=i(),v.insertStyleElement=p(),o()(f.A,v);const b=f.A&&f.A.locals?f.A.locals:void 0},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var r=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var r="";t.supports&&(r+="@supports (".concat(t.supports,") {")),t.media&&(r+="@media ".concat(t.media," {"));var o=void 0!==t.layer;o&&(r+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),r+=t.css,o&&(r+="}"),t.media&&(r+="}"),t.supports&&(r+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(r,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function t(r){var o=e[r];if(void 0!==o)return o.exports;var a=e[r]={id:r,exports:{}};return n[r](a,a.exports,t),a.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var r in e)t.o(e,r)&&!t.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:e[r]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.nc=void 0,(()=>{t(511);const n={userId:"1",groupId:"1",nickname:"用户",avatar:"",groupAvatar:"",permission:"SuperUser"},e="ws://localhost:11000";let r,o,a,i=null,s=0;const d=document.getElementById("chatWindow"),l=document.getElementById("messageInput"),c=document.getElementById("sendBtn"),m=document.getElementById("userinfoBtn"),p=document.getElementById("imageUpload"),u=document.getElementById("cloversBtn"),g=document.getElementById("imageUploadBtn"),f=document.getElementById("imagePreviewArea");let v=[];function b(){const n=l.value.trim();if(!n&&0===v.length)return;const e=v.map(n=>new Promise(e=>{const t=new FileReader;t.onload=n=>{var t;return e(null===(t=n.target)||void 0===t?void 0:t.result)},t.readAsDataURL(n)}));Promise.all(e).then(e=>{const t={id:s++,type:"user",senderId:r.userId,senderName:r.nickname,groupId:r.groupId,avatar:r.avatar,groupAvatar:r.groupAvatar,permission:r.permission,text:n,images:e,timestamp:Date.now()};x(t),l.value="",v=[],p.value="",f.innerHTML="",f.classList.remove("active"),l.focus();let o=!1;(null==i?void 0:i.readyState)===WebSocket.OPEN?(i.send(JSON.stringify(t)),o=!1):(y(),o=!0,null==i||i.addEventListener("open",()=>{o&&(i.send(JSON.stringify(t)),o=!1)},{once:!0}))})}function h(n,e){const t=new FileReader;t.onload=n=>{var t;const r=null===(t=n.target)||void 0===t?void 0:t.result,o=document.createElement("div");o.className="preview-item",o.dataset.index=e.toString();const a=document.createElement("img");a.className="preview-image",a.src=r,a.alt="预览图";const i=document.createElement("button");i.className="remove-image-btn",i.textContent="x",i.title="移除图片",i.onclick=()=>function(n){v.splice(n,1),f.innerHTML="",v.length>0?v.forEach((n,e)=>{h(n,e)}):f.classList.remove("active")}(e),o.appendChild(a),o.appendChild(i),f.appendChild(o),f.classList.add("active")},t.readAsDataURL(n)}function x(n){const e=document.createElement("div");if(e.className="message",e.dataset.id=n.id.toString(),"system"===n.type)e.classList.add("system"),e.innerHTML=`<p class="system-text">${n.text}</p>`;else if("user"===n.type){const t=n.senderName===r.nickname;e.classList.add(t?"self":"other");const o=document.createElement("p");o.className="username",o.textContent=n.senderName;const a=document.createElement("div");if(a.className="message-content",n.text){const e=document.createElement("p");e.className="message-text",e.textContent=n.text,a.appendChild(e)}if(n.images&&n.images.length>0){const e=document.createElement("div");e.className="image-group",n.images.forEach(n=>{const t=document.createElement("img");t.className="message-image-item",t.src=n,t.alt="聊天图片",t.loading="lazy",t.onclick=()=>{const e=document.createElement("div");e.className="modal",e.onclick=()=>{document.body.removeChild(e)},e.innerHTML=`<img src="${n}">`,document.body.appendChild(e)},e.appendChild(t)}),a.appendChild(e)}e.appendChild(o),e.appendChild(a)}d.appendChild(e),d.scrollTop=d.scrollHeight}function y(){if(a.startsWith("ws://")||a.startsWith("wss://")){if(i){if(i.url===a&&i.readyState===WebSocket.OPEN)return;i.close(1e3,"Changing server address"),i=null}try{i=new WebSocket(a),i.onopen=n=>{x({id:s++,type:"system",senderId:"",senderName:"系统",text:`连接成功！已连接到 ${a}`,timestamp:Date.now()})},i.onmessage=n=>{console.log("Received message:",n.data),function(n){try{const e=JSON.parse(n);if(!e.senderName||!e.text)return void console.warn("Received malformed message:",e);e.id=s++,e.timestamp||(e.timestamp=Date.now()),x(e)}catch(e){x({id:s++,type:"system",senderId:"",senderName:"服务器",text:`[原始数据]: ${n}`,timestamp:Date.now()}),console.error("Error parsing incoming message:",e,n)}}(n.data)},i.onclose=n=>{let e=n.reason||"服务器关闭";1e3!==n.code&&1005!==n.code&&(e=`连接异常关闭 (代码: ${n.code})`),x({id:s++,type:"system",senderId:"",senderName:"系统",text:`连接已断开: ${e}`,timestamp:Date.now()})},i.onerror=n=>{console.error("WebSocket Error:",n)}}catch(n){x({id:s++,type:"system",senderId:"",senderName:"系统",text:`WebSocket 实例化失败: ${n instanceof Error?n.message:String(n)}`,timestamp:Date.now()})}}else x({id:s++,type:"system",senderId:"",senderName:"系统",text:"连接失败: 地址格式错误。请使用 ws:// 或 wss:// 开头。",timestamp:Date.now()})}m.addEventListener("click",function e(){const t=document.createElement("div");t.className="modal",t.onclick=()=>{document.body.removeChild(t)};const a=document.createElement("div");a.className="modal-content",a.onclick=n=>{n.stopPropagation()};const i=document.createElement("div");i.className="user-list-title",i.textContent="用户列表",a.appendChild(i);const d=document.createElement("button");function l(n){const a=document.createElement("div");a.className="user-item",a.innerHTML=`\n            <div>\n                <strong>${n.nickname}</strong>\n                <span>ID: ${n.userId}</span>\n            </div>\n          `;const i=document.createElement("button");return i.className="tool-btn",i.innerHTML='<i class="fa-solid fa-gear"></i>',a.appendChild(i),a.addEventListener("click",()=>{document.body.removeChild(t),r=n,x({id:s++,type:"system",senderId:"",senderName:"系统",text:`已切换用户为「${n.nickname}」`,timestamp:Date.now()}),localStorage.setItem("currentUserInfo",JSON.stringify(n))}),i.addEventListener("click",r=>{r.stopPropagation(),document.body.removeChild(t),function(n){const t=document.createElement("div");t.className="modal",t.onclick=n=>{document.body.removeChild(t)};const r=document.createElement("div");r.className="modal-content",r.onclick=n=>{n.stopPropagation()},r.innerHTML=`\n        <h3>请输入用户信息</h3>\n        <div class="form-group">\n            <label for="userId">用户ID:</label>\n            <input type="text" id="userId" value="${n.userId}">\n        </div>\n        <div class="form-group">\n            <label for="nickname">昵称:</label>\n            <input type="text" id="nickname" value="${n.nickname}">\n        </div>\n        <div class="form-group">\n            <label for="groupId">群组ID:</label>\n            <input type="text" id="groupId" value="${n.groupId}">\n        </div>\n        <div class="form-group">\n            <label for="avatarUrl">用户头像URL:</label>\n            <input type="text" id="avatarUrl" value="${n.avatar}">\n        </div>\n        <div class="form-group">\n            <label for="groupAvatarUrl">群组头像URL:</label>\n            <input type="text" id="groupAvatarUrl" value="${n.groupAvatar}">\n        </div>\n        <div class="form-group">\n            <label for="permission">用户权限:</label>\n            <select id="permission">\n                <option value="SuperUser" ${"SuperUser"===n.permission?"selected":""}>超级用户</option>\n                <option value="Owner" ${"Owner"===n.permission?"selected":""}>群主</option>\n                <option value="Admin" ${"Admin"===n.permission?"selected":""}>管理员</option>\n                <option value="Member" ${"Member"===n.permission?"selected":""}>成员</option>\n            </select>\n        </div>\n        `;const a=document.createElement("div");a.className="form-actions";const i=document.createElement("button");i.id="confirmBtn",i.textContent="确认",a.appendChild(i);const s=document.createElement("button");s.id="cancelBtn",s.textContent="取消",a.appendChild(s);const d=document.createElement("button");d.id="deleteBtn",d.textContent="删除",a.appendChild(d),r.appendChild(a),t.appendChild(r),document.body.appendChild(t),i.onclick=()=>{const a=r.querySelector("#userId").value.trim(),i=r.querySelector("#nickname").value.trim(),s=r.querySelector("#groupId").value.trim(),d=r.querySelector("#avatarUrl").value.trim(),l=r.querySelector("#groupAvatarUrl").value.trim(),c=r.querySelector("#permission").value;n.userId=a,n.nickname=i,n.groupId=s,n.avatar=d,n.groupAvatar=l,n.permission=c,document.body.removeChild(t),e(),localStorage.setItem("userList",JSON.stringify(o))},s.onclick=()=>{document.body.removeChild(t),e()},d.onclick=()=>{const r=o.indexOf(n);-1!==r&&o.splice(r,1),document.body.removeChild(t),e(),localStorage.setItem("userList",JSON.stringify(o))}}(n)}),a}d.id="addUserBtn",d.textContent="+",i.appendChild(d),o.forEach(n=>{a.appendChild(l(n))}),d.onclick=()=>{let e=Object.assign({},n);o.push(e),a.appendChild(l(e)),localStorage.setItem("userList",JSON.stringify(o))},t.appendChild(a),document.body.appendChild(t)}),u.addEventListener("click",()=>{let n=prompt("请输入 clovers 服务器地址:",a);null!==n&&(n=n.trim(),n||(n=e),i&&a===n||(a=n,localStorage.setItem("currentCloversServer",a),y()))}),g.addEventListener("click",()=>{p.click()}),p.addEventListener("change",n=>{const e=n.target.files;if(e){for(let n=0;n<e.length;n++)e[n].type.startsWith("image/")&&v.push(e[n]);f.innerHTML="",v.forEach((n,e)=>{h(n,e)})}}),c.addEventListener("click",b),l.addEventListener("keydown",n=>{"Enter"===n.key&&(n.shiftKey||(n.preventDefault(),b()))}),document.addEventListener("DOMContentLoaded",()=>{try{const n=localStorage.getItem("currentUserInfo");if(!n)throw new Error("Default");r=JSON.parse(n)}catch(e){r=Object.assign({},n)}try{const n=localStorage.getItem("userList");if(!n)throw new Error("Default");o=JSON.parse(n)}catch(n){o=[r]}try{const n=localStorage.getItem("currentCloversServer");if(!n)throw new Error("Default");a=n}catch(n){a=e}x({id:s++,type:"system",senderId:"",senderName:"系统",text:"欢迎来到 clovers 终端！",timestamp:Date.now()}),y()})})()})();